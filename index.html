<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ„ å¹³å®‰å¤œå¿«ä¹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- MediaPipe Hands -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      text-align: center;
      overflow: hidden;
      font-family: sans-serif;
    }
    #tip {
      position: fixed;
      top: 20px;
      width: 100%;
      font-size: 20px;
      z-index: 10;
    }
    canvas {
      width: 100vw;
      height: 100vh;
    }
    video {
      display: none;
    }
  </style>
</head>

<body>
  <div id="tip">ğŸ‘‡ ç‚¹ä¸€ä¸‹å±å¹•ï¼Œç„¶åå¯¹ç€é•œå¤´å¼ å¼€æ‰‹æŒ âœ‹</div>

  <video id="video" playsinline></video>
  <canvas id="canvas"></canvas>

  <script>
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const tip = document.getElementById("tip");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let started = false;

    const hands = new Hands({
      locateFile: (file) =>
        `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`,
    });

    hands.setOptions({
      maxNumHands: 1,
      modelComplexity: 1,
      minDetectionConfidence: 0.7,
      minTrackingConfidence: 0.7,
    });

    hands.onResults((results) => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (!results.multiHandLandmarks) return;

      // ç”»æ‰‹éƒ¨éª¨æ¶ï¼ˆè¿™æ˜¯æœ€é‡è¦çš„è°ƒè¯•ç¡®è®¤ï¼‰
      for (const landmarks of results.multiHandLandmarks) {
        drawConnectors(ctx, landmarks, HAND_CONNECTIONS, {
          color: "#00FF00",
          lineWidth: 4,
        });
        drawLandmarks(ctx, landmarks, {
          color: "#FF0000",
          lineWidth: 2,
        });

        // åˆ¤æ–­æ˜¯å¦â€œå¼ å¼€æ‰‹æŒâ€
        const thumb = landmarks[4];
        const index = landmarks[8];
        const pinky = landmarks[20];

        const open =
          Math.abs(thumb.x - pinky.x) > 0.25 &&
          index.y < landmarks[6].y;

        if (open) {
          tip.innerText = "ğŸ„ å¹³å®‰å¤œå¿«ä¹ï¼";
          tip.style.color = "lime";
        }
      }
    });

    // å¿…é¡»ç‚¹å‡»é¡µé¢åæ‰èƒ½å¯åŠ¨ï¼ˆæ‰‹æœºæµè§ˆå™¨å¼ºåˆ¶è¦æ±‚ï¼‰
    document.body.addEventListener("click", async () => {
      if (started) return;
      started = true;

      tip.innerText = "ğŸ“· æ‘„åƒå¤´å¯åŠ¨ä¸­â€¦";

      const camera = new Camera(video, {
        onFrame: async () => {
          await hands.send({ image: video });
        },
        width: 640,
        height: 480,
      });

      try {
        await camera.start();
        tip.innerText = "âœ‹ è¯·å¯¹ç€é•œå¤´å¼ å¼€æ‰‹æŒ";
      } catch (e) {
        alert("æ‘„åƒå¤´å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æƒé™");
        console.error(e);
      }
    });
  </script>
</body>
</html>
