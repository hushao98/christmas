<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>ğŸ„ å¹³å®‰å¤œå¿«ä¹</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
html,body{
  margin:0;
  padding:0;
  background:linear-gradient(180deg,#ff9a9e,#fad0c4);
  overflow:hidden;
  font-family:"PingFang SC","Microsoft YaHei",sans-serif;
}

#tip{
  position:fixed;
  top:20px;
  width:100%;
  text-align:center;
  color:#fff;
  font-size:18px;
  z-index:10;
}

video{display:none}

.heart{
  position:absolute;
  font-size:22px;
  animation:fly 1.4s ease-out forwards;
  pointer-events:none;
}

@keyframes fly{
  from{opacity:1;transform:scale(.6)}
  to{
    opacity:0;
    transform:
      translate(
        calc(var(--x) * 1px),
        calc(var(--y) * 1px)
      )
      scale(1.4)
      rotate(360deg);
  }
}
</style>
</head>

<body>
<div id="tip">ğŸ‘‡ ç‚¹ä¸€ä¸‹å±å¹•ï¼Œå…è®¸æ‘„åƒå¤´</div>

<video id="video" playsinline></video>
<canvas id="canvas" width="80" height="60"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const tip = document.getElementById("tip");

let lastFrame = null;
let started = false;

function createHearts(){
  for(let i=0;i<12;i++){
    const h=document.createElement("div");
    h.className="heart";
    h.innerText="ğŸ’–";
    h.style.left=Math.random()*window.innerWidth+"px";
    h.style.top=Math.random()*window.innerHeight+"px";
    h.style.setProperty("--x",Math.random()*200-100);
    h.style.setProperty("--y",Math.random()*200-100);
    document.body.appendChild(h);
    setTimeout(()=>h.remove(),1400);
  }
}

function detectMotion(){
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  const frame = ctx.getImageData(0,0,canvas.width,canvas.height).data;

  if(lastFrame){
    let diff = 0;
    for(let i=0;i<frame.length;i+=16){
      diff += Math.abs(frame[i] - lastFrame[i]);
    }
    if(diff > 1200){
      tip.innerText = "ğŸ„ å¹³å®‰å¤œå¿«ä¹ âœ¨";
      createHearts();
    }
  }
  lastFrame = frame;
  requestAnimationFrame(detectMotion);
}

async function startCamera(){
  try{
    const stream = await navigator.mediaDevices.getUserMedia({
      video:{facingMode:"user"},
      audio:false
    });
    video.srcObject = stream;
    await video.play();
    tip.innerText="âœ‹ æŠŠæ‰‹æ”¾åˆ°é•œå¤´å‰è¯•è¯•";
    detectMotion();
  }catch(e){
    alert("æ‘„åƒå¤´å¯åŠ¨å¤±è´¥");
  }
}

document.body.addEventListener("click",()=>{
  if(started) return;
  started=true;
  startCamera();
});
</script>
</body>
</html>
