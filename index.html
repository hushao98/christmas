<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 è·¨å¹´æ‰‹åŠ¿äº¤äº’</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* è§†é¢‘å®¹å™¨ */
        .container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* æ‘„åƒå¤´ç”»é¢ (éšè—åŸå§‹è§†é¢‘ï¼Œåªæ˜¾ç¤ºCanvas) */
        .input_video {
            display: none;
        }

        /* ç»˜å›¾å±‚ */
        .output_canvas {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* é•œåƒç¿»è½¬ï¼Œè®©æ“ä½œæ›´è‡ªç„¶ */
            transform: scaleX(-1); 
        }

        /* æç¤ºå±‚ */
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
            z-index: 10;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            pointer-events: none;
        }

        h1 { margin: 0; font-size: 2rem; color: #ffeb3b; }
        p { font-size: 1.2rem; opacity: 0.8; }
        
        /* åŠ è½½åŠ¨ç”» */
        #loading {
            position: absolute;
            color: #00ffcc;
            font-size: 24px;
            z-index: 20;
        }
    </style>
</head>
<body>

    <div id="loading">æ­£åœ¨åŠ è½½ AI æ¨¡å‹ä¸æ‘„åƒå¤´...</div>

    <div class="container">
        <video class="input_video"></video>
        <canvas class="output_canvas"></canvas>
        
        <div id="ui-layer">
            <h1>ğŸ‰ 2026 è·¨å¹´äº’åŠ¨ ğŸ‰</h1>
            <p>âœŒï¸ æ‰‹åŠ¿ï¼šæ–°å¹´ç¥ç¦ | ğŸ–ï¸ æ‰‹åŠ¿ï¼šç‡ƒæ”¾çƒŸèŠ±</p>
        </div>
    </div>

<script>
    const videoElement = document.getElementsByClassName('input_video')[0];
    const canvasElement = document.getElementsByClassName('output_canvas')[0];
    const canvasCtx = canvasElement.getContext('2d');
    const loadingDiv = document.getElementById('loading');

    // å…¨å±€çŠ¶æ€
    let fireworks = [];
    let showGreeting = false;
    
    // è®¾ç½® Canvas å°ºå¯¸
    function resizeCanvas() {
        canvasElement.width = window.innerWidth;
        canvasElement.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // --- çƒŸèŠ±ç²’å­ç³»ç»Ÿ ---
    class Particle {
        constructor(x, y, color) {
            this.x = x;
            this.y = y;
            this.color = color;
            const angle = Math.random() * Math.PI * 2;
            const speed = Math.random() * 5 + 2;
            this.vx = Math.cos(angle) * speed;
            this.vy = Math.sin(angle) * speed;
            this.alpha = 1;
            this.decay = Math.random() * 0.02 + 0.01;
            this.gravity = 0.1;
        }

        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.vy += this.gravity; // é‡åŠ›
            this.alpha -= this.decay;
        }

        draw(ctx) {
            ctx.save();
            ctx.globalAlpha = this.alpha;
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }
    }

    class Firework {
        constructor(x, y) {
            this.particles = [];
            const colors = ['#ff0040', '#00ffcc', '#ffff00', '#ff00ff', '#00ccff'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            for (let i = 0; i < 50; i++) {
                this.particles.push(new Particle(x, y, color));
            }
        }

        update() {
            this.particles.forEach(p => p.update());
            this.particles = this.particles.filter(p => p.alpha > 0);
        }

        draw(ctx) {
            this.particles.forEach(p => p.draw(ctx));
        }

        isDead() {
            return this.particles.length === 0;
        }
    }

    // --- MediaPipe æ‰‹åŠ¿é€»è¾‘ ---
    
    function onResults(results) {
        // æ¸…é™¤ä¸Šä¸€å¸§
        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
        
        // ç»˜åˆ¶æ‘„åƒå¤´èƒŒæ™¯ (ç¨å¾®å˜æš—ä»¥ä¾¿çœ‹æ¸…ç‰¹æ•ˆ)
        canvasCtx.globalAlpha = 0.6; 
        canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
        canvasCtx.globalAlpha = 1.0;

        showGreeting = false;

        if (results.multiHandLandmarks) {
            // éšè—åŠ è½½æ–‡å­—
            loadingDiv.style.display = 'none';

            for (const landmarks of results.multiHandLandmarks) {
                // ç»˜åˆ¶éª¨æ¶
                drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: '#00FF00', lineWidth: 2});
                drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 1});

                // --- æ‰‹åŠ¿è¯†åˆ«é€»è¾‘ ---
                const fingers = countFingers(landmarks);
                
                // 1. å¼ å¼€æ‰‹æŒ (5æŒ‡) -> è§¦å‘çƒŸèŠ±
                if (fingers.total === 5) {
                    // ä»…å½“éšæœºæ¦‚ç‡è§¦å‘ï¼Œé˜²æ­¢æ¯å¸§éƒ½ç”Ÿæˆå¤ªå¤š
                    if (Math.random() < 0.2) {
                        // åœ¨æŒ‡å°–ä½ç½®ç”ŸæˆçƒŸèŠ± (ç´¢å¼• 8 æ˜¯é£ŸæŒ‡æŒ‡å°–)
                        // éœ€è¦å°†å½’ä¸€åŒ–åæ ‡(0-1)è½¬æ¢ä¸º Canvas åƒç´ åæ ‡
                        const x = landmarks[8].x * canvasElement.width;
                        const y = landmarks[8].y * canvasElement.height;
                        fireworks.push(new Firework(x, y));
                    }
                }

                // 2. å‰ªåˆ€æ‰‹/è€¶ (é£ŸæŒ‡+ä¸­æŒ‡) -> æ˜¾ç¤º 2026
                if (fingers.index && fingers.middle && !fingers.ring && !fingers.pinky) {
                    showGreeting = true;
                }
            }
        }

        // --- ç»˜åˆ¶ç‰¹æ•ˆ ---
        
        // æ›´æ–°å’Œç»˜åˆ¶çƒŸèŠ±
        fireworks.forEach((fw, index) => {
            fw.update();
            fw.draw(canvasCtx);
            if (fw.isDead()) fireworks.splice(index, 1);
        });

        // ç»˜åˆ¶ "2026" ç¥ç¦
        if (showGreeting) {
            drawGreetingText();
        }

        canvasCtx.restore();
    }

    // ç®€å•çš„æ•°æ‰‹æŒ‡å‡½æ•°
    function countFingers(landmarks) {
        // æŒ‡å°–ç´¢å¼•: 4(æ‹‡æŒ‡), 8(é£ŸæŒ‡), 12(ä¸­æŒ‡), 16(æ— åæŒ‡), 20(å°æŒ‡)
        // å…³èŠ‚ç´¢å¼•: æ‹‡æŒ‡æ¯”è¾ƒç‰¹æ®Šç”¨ x è½´æˆ– IP å…³èŠ‚ï¼Œå…¶ä»–æ‰‹æŒ‡æ¯”è¾ƒ y è½´ä¸ PIP å…³èŠ‚
        
        let status = { thumb: false, index: false, middle: false, ring: false, pinky: false, total: 0 };

        // æ‹‡æŒ‡ (æ¯”è¾ƒæŒ‡å°–å’Œ IP å…³èŠ‚çš„ x è·ç¦»ï¼Œç®€å•åˆ¤æ–­)
        // æ³¨æ„ï¼šå·¦å³æ‰‹æ‹‡æŒ‡æ–¹å‘ä¸åŒï¼Œè¿™é‡Œåšç®€åŒ–åˆ¤æ–­ï¼Œå‡è®¾æ‰‹æŒæœå‘æ‘„åƒå¤´
        // å¦‚æœæŒ‡å°–(4) åˆ° å°æŒ‡æ ¹éƒ¨(17) çš„è·ç¦» > IPå…³èŠ‚(3) åˆ° å°æŒ‡æ ¹éƒ¨(17) çš„è·ç¦»ï¼Œç®—å¼ å¼€
        // è¿™æ˜¯ä¸€ä¸ªè¿‘ä¼¼ç®—æ³•
        const dist4_17 = Math.hypot(landmarks[4].x - landmarks[17].x, landmarks[4].y - landmarks[17].y);
        const dist3_17 = Math.hypot(landmarks[3].x - landmarks[17].x, landmarks[3].y - landmarks[17].y);
        if (dist4_17 > dist3_17) status.thumb = true;

        // å…¶ä»–å››æŒ‡ (æŒ‡å°– y < å…³èŠ‚ yï¼Œæ³¨æ„ y è½´å‘ä¸‹ä¸ºæ­£ï¼Œæ‰€ä»¥æ•°å€¼è¶Šå°è¶Šé«˜)
        if (landmarks[8].y < landmarks[6].y) status.index = true;
        if (landmarks[12].y < landmarks[10].y) status.middle = true;
        if (landmarks[16].y < landmarks[14].y) status.ring = true;
        if (landmarks[20].y < landmarks[18].y) status.pinky = true;

        status.total = (status.thumb?1:0) + (status.index?1:0) + (status.middle?1:0) + (status.ring?1:0) + (status.pinky?1:0);
        return status;
    }

    function drawGreetingText() {
        canvasCtx.save();
        // å› ä¸º Canvas è¢«é•œåƒç¿»è½¬äº†ï¼Œç»˜åˆ¶æ–‡å­—éœ€è¦åè½¬å›æ¥ï¼Œå¦åˆ™æ–‡å­—æ˜¯åçš„
        canvasCtx.translate(canvasElement.width, 0);
        canvasCtx.scale(-1, 1);
        
        canvasCtx.font = "bold 80px sans-serif";
        canvasCtx.fillStyle = "#fff";
        canvasCtx.shadowColor = "#ff00de";
        canvasCtx.shadowBlur = 20;
        canvasCtx.textAlign = "center";
        
        canvasCtx.fillText("âœ¨ 2026 æ–°å¹´å¿«ä¹ âœ¨", canvasElement.width / 2, canvasElement.height / 2);
        
        canvasCtx.restore();
    }

    // --- åˆå§‹åŒ– MediaPipe Hands ---
    const hands = new Hands({locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
    }});

    hands.setOptions({
        maxNumHands: 2,
        modelComplexity: 1,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
    });

    hands.onResults(onResults);

    // --- å¯åŠ¨æ‘„åƒå¤´ ---
    const camera = new Camera(videoElement, {
        onFrame: async () => {
            await hands.send({image: videoElement});
        },
        width: 1280,
        height: 720
    });
    camera.start();

</script>
</body>
</html>
