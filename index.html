<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¹³å®‰å¤œå¿«ä¹ ğŸ„</title>

<style>
html, body { margin:0; padding:0; height:100%; overflow:hidden; font-family:"PingFang SC","Microsoft YaHei",sans-serif; background: linear-gradient(180deg, #ff9a9e, #fad0c4); color:#fff; }
body::after { content:""; position:fixed; inset:0; background:radial-gradient(circle at center,rgba(255,255,255,0.18),rgba(255,255,255,0) 60%); animation:glow 6s ease-in-out infinite; pointer-events:none; }
@keyframes glow {0%,100%{opacity:.4;}50%{opacity:.7;}}
.bg-tree {position:absolute; bottom:-40px; left:50%; transform:translateX(-50%); font-size:320px; opacity:0.28; animation:treeMove 6s ease-in-out infinite; pointer-events:none;}
@keyframes treeMove {0%,100%{transform:translateX(-50%) scale(1);}50%{transform:translateX(-50%) scale(1.06);}}
.star {position:absolute; bottom:360px; left:50%; transform:translateX(-50%); font-size:48px; animation:starGlow 2.5s ease-in-out infinite;}
@keyframes starGlow {0%,100%{opacity:0.6;transform:translateX(-50%) scale(1);}50%{opacity:1;transform:translateX(-50%) scale(1.25);}}
.card {position:relative; z-index:10; width:88%; max-width:360px; margin:auto; top:50%; transform:translateY(-50%); text-align:center; padding:30px 22px; background:transparent; border-radius:22px; animation:float 4s ease-in-out infinite;}
@keyframes float {0%,100%{transform:translateY(-50%) translateY(0);}50%{transform:translateY(-50%) translateY(-14px);}}
h1 {font-size:24px; margin-bottom:10px;}
.name {font-size:20px; margin-bottom:6px; animation:heartbeat 2.4s infinite;}
@keyframes heartbeat {0%,100%{transform:scale(1); text-shadow:0 0 6px rgba(255,255,255,.4);}50%{transform:scale(1.08); text-shadow:0 0 16px rgba(255,255,255,.9);}}
.message {position:absolute; font-size:16px; white-space:nowrap; animation:rise 3s ease-out forwards; pointer-events:none;}
@keyframes rise {0%{opacity:0; transform:translateY(10px) scale(0.95);}25%{opacity:1;}100%{opacity:0; transform:translateY(-140px) scale(1.08);}}
.heart-burst {position:absolute; font-size:20px; animation:burst 1.3s ease-out forwards; pointer-events:none;}
@keyframes burst {0%{transform:scale(0.3);opacity:1;}100%{transform:translate(var(--x), var(--y)) scale(1.4) rotate(360deg); opacity:0;}}
.spark {position:absolute; font-size:12px; opacity:.8; animation:sparkFly 1.6s linear forwards; pointer-events:none;}
@keyframes sparkFly {to{transform:translate(var(--sx), var(--sy)); opacity:0;}}
.snow {position:absolute; top:-10px; font-size:14px; animation:snowFall linear infinite;}
@keyframes snowFall {to{transform:translateY(110vh);}}
#tip{position:fixed; top:20px; width:100%; text-align:center; font-size:18px; color:#fff; z-index:20;}
video{position:fixed; inset:0; width:100%; height:100%; object-fit:cover; opacity:0.25;}
</style>
</head>
<body>
<div class="bg-tree">ğŸ„</div>
<div class="star">â­</div>
<div class="card">
    <h1>å¹³å®‰å¤œå¿«ä¹</h1>
    <div class="name">To å°å·¦ ğŸ’•</div>
</div>
<div id="tip">ğŸ‘‡ ç‚¹å‡»å±å¹•å¯åŠ¨æ‰‹åŠ¿</div>
<audio id="bgm" loop>
    <source src="https://cdn.pixabay.com/audio/2022/12/05/audio_5a7c3f9db8.mp3">
</audio>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
// ---------------- é›ªèŠ± & ç‚¹å‡»åŠ¨ç”» ----------------
const messages = [
    "å°å·¦ï¼Œæˆ‘å¥½åƒè¶Šæ¥è¶Šç¦»ä¸å¼€ä½ äº†",
    "é ä½ è¿‘ä¸€ç‚¹ï¼Œå¿ƒå°±ä¹±ä¸€ç‚¹ ğŸ’—",
    "å¦‚æœå¯ä»¥ï¼Œæˆ‘æƒ³ä¸€ç›´è¿™æ ·é™ªç€ä½ ",
    "ä½ åœ¨çš„æ—¶å€™ï¼Œæˆ‘ä»€ä¹ˆéƒ½ä¸æƒ³è¦",
    "ä»Šæ™šæœ‰ç‚¹ç”œï¼Œå¤§æ¦‚æ˜¯ä½ åœ¨æˆ‘å¿ƒé‡Œ",
    "æˆ‘å¥½åƒå¼€å§‹ä¹ æƒ¯ä½ äº†",
    "å¹³å®‰å¤œï¼Œåªæƒ³è¢«ä½ æŠ±ç´§",
    "å°å·¦ï¼Œä½ èƒ½ä¸èƒ½åˆ«èµ°"
];

document.addEventListener("click", e=>{
    const bgm = document.getElementById("bgm"); if(bgm.paused) bgm.play();
    const msg=document.createElement("div"); msg.className="message";
    msg.innerText=messages[Math.floor(Math.random()*messages.length)];
    msg.style.left=e.clientX+"px"; msg.style.top=e.clientY+"px";
    document.body.appendChild(msg); setTimeout(()=>msg.remove(),3000);
    for(let i=0;i<14;i++){ const h=document.createElement("div"); h.className="heart-burst"; h.innerText="ğŸ’–"; h.style.left=e.clientX+"px"; h.style.top=e.clientY+"px";
    h.style.setProperty("--x",(Math.random()*180-90)+"px"); h.style.setProperty("--y",(Math.random()*180-90)+"px"); document.body.appendChild(h); setTimeout(()=>h.remove(),1300);}
    for(let i=0;i<8;i++){ const s=document.createElement("div"); s.className="spark"; s.innerText="âœ¨"; s.style.left=e.clientX+"px"; s.style.top=e.clientY+"px";
    s.style.setProperty("--sx",(Math.random()*120-60)+"px"); s.style.setProperty("--sy",(Math.random()*120-60)+"px"); document.body.appendChild(s); setTimeout(()=>s.remove(),1600);}
});

setInterval(()=>{
    const snow=document.createElement("div"); snow.className="snow"; snow.innerText="â„ï¸";
    snow.style.left=Math.random()*window.innerWidth+"px";
    snow.style.fontSize=(Math.random()*10+10)+"px";
    snow.style.animationDuration=(Math.random()*5+5)+"s";
    document.body.appendChild(snow); setTimeout(()=>snow.remove(),10000);
},350);

// ---------------- æ‰‹åŠ¿è¯†åˆ« ----------------
const video = document.createElement('video'); video.autoplay=true; video.playsInline=true;

function createHearts(){for(let i=0;i<12;i++){const h=document.createElement("div"); h.className="heart-burst"; h.innerText="ğŸ’–";
h.style.left=Math.random()*window.innerWidth+"px"; h.style.top=Math.random()*window.innerHeight+"px";
h.style.setProperty("--x",Math.random()*200-100); h.style.setProperty("--y",Math.random()*200-100);
document.body.appendChild(h); setTimeout(()=>h.remove(),1400);}}

function createSparks(){for(let i=0;i<10;i++){const s=document.createElement("div"); s.className="spark"; s.innerText="âœ¨";
s.style.left=Math.random()*window.innerWidth+"px"; s.style.top=Math.random()*window.innerHeight+"px";
s.style.setProperty("--sx",Math.random()*120-60); s.style.setProperty("--sy",Math.random()*120-60);
document.body.appendChild(s); setTimeout(()=>s.remove(),1600);}

// åˆå§‹åŒ– MediaPipe Hands
const hands = new Hands({locateFile:(file)=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
hands.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:0.7,minTrackingConfidence:0.7});

hands.onResults(results=>{
    if(!results.multiHandLandmarks || results.multiHandLandmarks.length===0) return;
    const landmarks = results.multiHandLandmarks[0];
    // ç®€å•æ‰‹åŠ¿åˆ¤æ–­ï¼šå¼ å¼€æ‰‹æŒ/æ¡æ‹³/æ¯”å¿ƒ
    const thumb_tip = landmarks[4], index_tip = landmarks[8], middle_tip=landmarks[12];
    const ring_tip = landmarks[16], pinky_tip=landmarks[20];
    const wrist = landmarks[0];

    function distance(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}
    const palm_size = distance(wrist, middle_tip);

    // åˆ¤æ–­å¼ å¼€æ‰‹æŒ
    const fingers_extended = [index_tip,middle_tip,ring_tip,pinky_tip].filter(f=>distance(f,wrist)/palm_size>0.5).length;
    if(fingers_extended>=4){ createHearts(); return; } // å¼ å¼€æ‰‹æŒ
    // åˆ¤æ–­æ¡æ‹³
    if(fingers_extended<=1){ createSparks(); return; } // æ¡æ‹³
    // æ¯”å¿ƒæ‰‹åŠ¿ï¼ˆé£ŸæŒ‡+ä¸­æŒ‡ä¼¸ç›´ï¼Œå…¶ä»–å¼¯æ›²ï¼‰
    if(fingers_extended===2){ showRandomMessage(); return; }
});

// å¯åŠ¨æ‘„åƒå¤´ + Hands camera
let camera=null;
function startCamera(){
    navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}}).then(stream=>{
        video.srcObject=stream;
        video.play();
        document.getElementById('tip').innerText="âœ‹ æŠŠæ‰‹æ”¾åˆ°æ‘„åƒå¤´å‰è¯•è¯•";
        camera = new Camera(video,{onFrame:async()=>{await hands.send({image:video});},width:640,height:480});
        camera.start();
    }).catch(e=>alert("æ‘„åƒå¤´å¯åŠ¨å¤±è´¥"));
}

// æ˜¾ç¤ºæƒ…è¯
function showRandomMessage(){
    const msg=document.createElement("div"); msg.className="message";
    msg.innerText=messages[Math.floor(Math.random()*messages.length)];
    msg.style.left=window.innerWidth/2+"px";
    msg.style.top=window.innerHeight/2+"px";
    document.body.appendChild(msg);
    setTimeout(()=>msg.remove(),3000);
}

// ç‚¹å‡»å¯åŠ¨
document.body.addEventListener("click",()=>{startCamera();}, {once:true});
</script>
</body>
</html>
