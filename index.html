<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ„ å¹³å®‰å¤œå¿«ä¹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- MediaPipe Handsï¼ˆåªç”¨ hands + drawingï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      text-align: center;
      overflow: hidden;
      font-family: sans-serif;
    }
    #tip {
      position: fixed;
      top: 20px;
      width: 100%;
      font-size: 20px;
      z-index: 10;
    }
    canvas {
      width: 100vw;
      height: 100vh;
    }
    video {
      display: none;
    }
  </style>
</head>

<body>
  <div id="tip">ğŸ‘‡ ç‚¹ä¸€ä¸‹å±å¹•ï¼Œå…è®¸æ‘„åƒå¤´</div>

  <video id="video" playsinline></video>
  <canvas id="canvas"></canvas>

  <script>
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const tip = document.getElementById("tip");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let started = false;

    // åˆå§‹åŒ– Hands
    const hands = new Hands({
      locateFile: (file) =>
        `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`,
    });

    hands.setOptions({
      maxNumHands: 1,
      modelComplexity: 1,
      minDetectionConfidence: 0.7,
      minTrackingConfidence: 0.7,
    });

    hands.onResults((results) => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (!results.multiHandLandmarks) return;

      for (const landmarks of results.multiHandLandmarks) {
        // ç”»éª¨æ¶ï¼ˆå…³é”®è°ƒè¯•ä¿¡å·ï¼‰
        drawConnectors(ctx, landmarks, HAND_CONNECTIONS, {
          color: "#00FF00",
          lineWidth: 4,
        });
        drawLandmarks(ctx, landmarks, {
          color: "#FF0000",
          lineWidth: 2,
        });

        // ç®€å•åˆ¤æ–­ï¼šå¼ å¼€æ‰‹
        const thumb = landmarks[4];
        const pinky = landmarks[20];

        if (Math.abs(thumb.x - pinky.x) > 0.25) {
          tip.innerText = "ğŸ„ å¹³å®‰å¤œå¿«ä¹ï¼";
          tip.style.color = "lime";
        }
      }
    });

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: "user",
          },
          audio: false,
        });

        video.srcObject = stream;
        await video.play();

        tip.innerText = "âœ‹ è¯·å¯¹ç€é•œå¤´å¼ å¼€æ‰‹æŒ";

        async function frameLoop() {
          await hands.send({ image: video });
          requestAnimationFrame(frameLoop);
        }

        frameLoop();
      } catch (e) {
        alert("æ‘„åƒå¤´å¯åŠ¨å¤±è´¥");
        console.error(e);
      }
    }

    // å¿…é¡»ç”¨æˆ·ç‚¹å‡»
    document.body.addEventListener("click", () => {
      if (started) return;
      started = true;
      startCamera();
    });
  </script>
</body>
</html>
