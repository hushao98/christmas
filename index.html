<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¹³å®‰å¤œå¿«ä¹ ğŸ„</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
}

/* èƒŒæ™¯ */
body {
    background: linear-gradient(180deg, #ff9a9e, #fad0c4);
    color: #fff;
}

/* èƒŒæ™¯æŸ”å…‰å‘¼å¸ */
body::after {
    content: "";
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at center,
        rgba(255,255,255,0.18),
        rgba(255,255,255,0) 60%);
    animation: glow 6s ease-in-out infinite;
    pointer-events: none;
}

@keyframes glow {
    0%,100% { opacity: .4; }
    50% { opacity: .7; }
}

/* å·¨å‹åœ£è¯æ ‘ */
.bg-tree {
    position: absolute;
    bottom: -40px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 320px;
    opacity: 0.28;
    animation: treeMove 6s ease-in-out infinite;
    pointer-events: none;
}

@keyframes treeMove {
    0%,100% { transform: translateX(-50%) scale(1); }
    50% { transform: translateX(-50%) scale(1.06); }
}

/* æ˜Ÿæ˜Ÿ */
.star {
    position: absolute;
    bottom: 360px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 48px;
    animation: starGlow 2.5s ease-in-out infinite;
}

@keyframes starGlow {
    0%,100% { opacity: 0.6; transform: translateX(-50%) scale(1); }
    50% { opacity: 1; transform: translateX(-50%) scale(1.25); }
}

/* ä¸»å¡ç‰‡ */
.card {
    position: relative;
    z-index: 10;
    width: 88%;
    max-width: 360px;
    margin: auto;
    top: 50%;
    transform: translateY(-50%);
    text-align: center;
    padding: 30px 22px;
    background: transparent;
    border-radius: 22px;
    box-shadow: none;
    backdrop-filter: none;
    animation: float 4s ease-in-out infinite;
}

@keyframes float {
    0%,100% { transform: translateY(-50%) translateY(0); }
    50% { transform: translateY(-50%) translateY(-14px); }
}

h1 {
    font-size: 24px;
    margin-bottom: 10px;
}

/* åå­—ï¼šå¿ƒè·³æ„Ÿ */
.name {
    font-size: 20px;
    margin-bottom: 6px;
    animation: heartbeat 2.4s infinite;
}

@keyframes heartbeat {
    0%,100% {
        transform: scale(1);
        text-shadow: 0 0 6px rgba(255,255,255,.4);
    }
    50% {
        transform: scale(1.08);
        text-shadow: 0 0 16px rgba(255,255,255,.9);
    }
}

/* æƒ…è¯ */
.message {
    position: absolute;
    font-size: 16px;
    white-space: nowrap;
    animation: rise 3s ease-out forwards;
    pointer-events: none;
}

@keyframes rise {
    0% { opacity: 0; transform: translateY(10px) scale(0.95); }
    25% { opacity: 1; }
    100% { opacity: 0; transform: translateY(-140px) scale(1.08); }
}

/* çˆ±å¿ƒçˆ†ç‚¸ */
.heart-burst {
    position: absolute;
    font-size: 20px;
    animation: burst 1.3s ease-out forwards;
    pointer-events: none;
}

@keyframes burst {
    0% { transform: scale(0.3); opacity: 1; }
    100% {
        transform: translate(var(--x), var(--y)) scale(1.4) rotate(360deg);
        opacity: 0;
    }
}

/* æ˜Ÿå…‰ç²’å­ */
.spark {
    position: absolute;
    font-size: 12px;
    opacity: .8;
    animation: sparkFly 1.6s linear forwards;
    pointer-events: none;
}

@keyframes sparkFly {
    to {
        transform: translate(var(--sx), var(--sy));
        opacity: 0;
    }
}

/* é›ª */
.snow {
    position: absolute;
    top: -10px;
    font-size: 14px;
    animation: snowFall linear infinite;
}

@keyframes snowFall {
    to { transform: translateY(110vh); }
}
</style>
</head>

<body>

<div class="bg-tree">ğŸ„</div>
<div class="star">â­</div>

<div class="card">
    <h1>å¹³å®‰å¤œå¿«ä¹</h1>
    <div class="name">To å°å·¦ ğŸ’•</div>
</div>

<audio id="bgm" loop>
    <source src="https://cdn.pixabay.com/audio/2022/12/05/audio_5a7c3f9db8.mp3">
</audio>

<video id="video" playsinline autoplay muted style="display:none;"></video>
<canvas id="canvas" width="80" height="60" style="display:none;"></canvas>

<script>
// æƒ…è¯æ•°ç»„
const messages = [
    "å°å·¦ï¼Œæˆ‘å¥½åƒè¶Šæ¥è¶Šç¦»ä¸å¼€ä½ äº†",
    "é ä½ è¿‘ä¸€ç‚¹ï¼Œå¿ƒå°±ä¹±ä¸€ç‚¹ ğŸ’—",
    "å¦‚æœå¯ä»¥ï¼Œæˆ‘æƒ³ä¸€ç›´è¿™æ ·é™ªç€ä½ ",
    "ä½ åœ¨çš„æ—¶å€™ï¼Œæˆ‘ä»€ä¹ˆéƒ½ä¸æƒ³è¦",
    "ä»Šæ™šæœ‰ç‚¹ç”œï¼Œå¤§æ¦‚æ˜¯ä½ åœ¨æˆ‘å¿ƒé‡Œ",
    "æˆ‘å¥½åƒå¼€å§‹ä¹ æƒ¯ä½ äº†",
    "å¹³å®‰å¤œï¼Œåªæƒ³è¢«ä½ æŠ±ç´§",
    "å°å·¦ï¼Œä½ èƒ½ä¸èƒ½åˆ«èµ°"
];

// è·å–å…ƒç´ 
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const tip = document.querySelector(".card h1");

let started = false;
let lastFrame = null;

// åˆ›å»ºçˆ±å¿ƒ
function createHearts(x,y){
    for(let i=0;i<14;i++){
        const h=document.createElement("div");
        h.className="heart-burst";
        h.innerText="ğŸ’–";
        h.style.left=x+"px";
        h.style.top=y+"px";
        h.style.setProperty("--x",(Math.random()*180-90)+"px");
        h.style.setProperty("--y",(Math.random()*180-90)+"px");
        document.body.appendChild(h);
        setTimeout(()=>h.remove(),1300);
    }
}

// åˆ›å»ºæƒ…è¯
function createMessage(x,y){
    const msg = document.createElement("div");
    msg.className = "message";
    msg.innerText = messages[Math.floor(Math.random()*messages.length)];
    msg.style.left = x + "px";
    msg.style.top = y + "px";
    document.body.appendChild(msg);
    setTimeout(()=>msg.remove(),3000);
}

// æ‰‹åŠ¿æ£€æµ‹ï¼ˆå¼ å¼€/æ¡æ‹³ï¼‰
function detectGesture(){
    if(!video.videoWidth) return;

    // ç¼©å°ç”»å¸ƒåšè®¡ç®—
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    const frame = ctx.getImageData(0,0,canvas.width,canvas.height).data;

    let sum = 0;
    for(let i=0;i<frame.length;i+=4){
        sum += frame[i]+frame[i+1]+frame[i+2]; // RGBäº®åº¦
    }

    // é¢ç§¯å¤§å°æ¯”ä¾‹ï¼Œç®€å•åŒºåˆ†å¼ å¼€/æ¡æ‹³
    const area = sum / frame.length;

    if(area > 60){ // å¼ å¼€æ‰‹
        tip.innerText = "ğŸ„ å¹³å®‰å¤œå¿«ä¹ï¼";
        createHearts(window.innerWidth/2, window.innerHeight/2);
    } else if(area > 20){ // æ¡æ‹³
        tip.innerText = "ğŸ’Œ ç»™ä½ ä¸€ä¸ªæ‹¥æŠ±";
        createHearts(window.innerWidth/2, window.innerHeight/2);
    }
}

// å¯åŠ¨æ‘„åƒå¤´
async function startCamera(){
    try{
        const stream = await navigator.mediaDevices.getUserMedia({
            video:{facingMode:"user"},
            audio:false
        });
        video.srcObject = stream;
        await video.play();
        requestAnimationFrame(loop);
    }catch(e){
        alert("æ‘„åƒå¤´å¯åŠ¨å¤±è´¥");
        console.error(e);
    }
}

// ä¸»å¾ªç¯
function loop(){
    detectGesture();
    requestAnimationFrame(loop);
}

// ç‚¹å‡»å¯åŠ¨
document.body.addEventListener("click",()=>{
    if(started) return;
    started = true;

    // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
    const bgm = document.getElementById("bgm");
    if(bgm.paused) bgm.play();

    startCamera();
});
</script>

</body>
</html>
