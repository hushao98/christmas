<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ç‚«é…·æ‰‹åŠ¿äº¤äº’</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:black;
  font-family:sans-serif;
  touch-action:none;
}

#tip{
  position:fixed;
  top:20px;
  width:100%;
  text-align:center;
  color:#00ffea;
  font-size:18px;
  z-index:10;
}

video{display:none}

.particle{
  position:absolute;
  font-size:18px;
  pointer-events:none;
  animation:fly 1.5s linear forwards;
}

@keyframes fly{
  from{opacity:1; transform:scale(0.6);}
  to{
    opacity:0;
    transform:translate(calc(var(--x)*1px), calc(var(--y)*1px)) scale(1.4) rotate(360deg);
  }
}
</style>
</head>

<body>
<div id="tip">ğŸ‘‡ ç‚¹ä¸€ä¸‹å±å¹•ï¼Œç„¶åå¯¹ç€é•œå¤´æŒ¥åŠ¨æ‰‹æŒ âœ‹</div>
<video id="video" playsinline autoplay muted></video>
<canvas id="canvas"></canvas>

<script>
const tip = document.getElementById("tip");
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let started = false;
let lastFrame = null;

// ç”Ÿæˆç²’å­æ•ˆæœ
function createParticles(count=15){
  for(let i=0;i<count;i++){
    const p=document.createElement("div");
    p.className="particle";
    p.innerText="âœ¨";
    p.style.left=Math.random()*window.innerWidth+"px";
    p.style.top=Math.random()*window.innerHeight+"px";
    p.style.setProperty("--x",Math.random()*300-150);
    p.style.setProperty("--y",Math.random()*300-150);
    p.style.color=`hsl(${Math.random()*360},100%,70%)`;
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),1500);
  }
}

// æ£€æµ‹ç”»é¢å˜åŒ–ï¼ˆæ‰‹åŠ¿é è¿‘ï¼‰
function detectMotion(){
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  const frame=ctx.getImageData(0,0,canvas.width,canvas.height).data;
  
  if(lastFrame){
    let diff=0;
    for(let i=0;i<frame.length;i+=16){
      diff+=Math.abs(frame[i]-lastFrame[i]);
    }
    if(diff>1500){ // è°ƒèŠ‚çµæ•åº¦
      tip.innerText="ğŸŒŸ æ‰‹åŠ¿è§¦å‘ç‰¹æ•ˆï¼";
      createParticles(20);
    }
  }
  lastFrame=frame;
  requestAnimationFrame(detectMotion);
}

async function startCamera(){
  try{
    const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:false});
    video.srcObject = stream;
    await video.play();
    tip.innerText="âœ¨ å¯¹ç€é•œå¤´æŒ¥åŠ¨æ‰‹æŒè§¦å‘ç‰¹æ•ˆ";
    detectMotion();
  }catch(e){
    alert("æ‘„åƒå¤´å¯åŠ¨å¤±è´¥");
    console.error(e);
  }
}

// ç‚¹å‡»å±å¹•å¯åŠ¨
document.body.addEventListener("click",()=>{
  if(started) return;
  started=true;
  startCamera();
});
</script>
</body>
</html>
